# å¡”ç½—ç‰Œæ•°æ®å¯¼å…¥è®¡åˆ’

## ğŸ“‹ æ•°æ®æ¦‚è§ˆ

å·²å®Œæˆçš„ JSON æ•°æ®æ–‡ä»¶ä½äº `my-tarot-app/assets/data/` ç›®å½•ä¸‹ï¼š

| æ–‡ä»¶å | ç‰ˆæœ¬ | æ›´æ–°æ—¶é—´ | è®°å½•æ•° | æè¿° |
|--------|------|----------|---------|------|
| `cards.json` | 1.0.0 | 2025-01-12T10:00:00Z | 78 | å®Œæ•´çš„78å¼ å¡”ç½—ç‰ŒåŸºç¡€ä¿¡æ¯ |
| `card_styles.json` | 1.0.0 | 2025-01-12T10:00:00Z | 1 | å¡ç‰Œé£æ ¼å®šä¹‰ï¼ˆ1920-raider-waiteï¼‰ |
| `dimensions.json` | 1.0.2 | 2025-09-12T01:18:52Z | ~æ•°ç™¾æ¡ | è§£è¯»ç»´åº¦å®šä¹‰ï¼ˆä¸‰ç‰Œæ˜ å°„æ¨¡å¼ï¼‰ |
| `spreads.json` | 1.0.0 | 2025-01-12T10:00:00Z | 1 | ç‰Œé˜µå®šä¹‰ï¼ˆä¸‰ç‰Œé˜µï¼‰ |
| `card_interpretations.json` | 1.0.8 | 2025-09-12T02:57:02Z | 156 | ç‰Œæ„è§£è¯»ï¼ˆ78Ã—2ï¼Œæ­£ä½+é€†ä½ï¼‰ |
| `card_interpretation_dimensions.json` | 1.0.0 | 2025-09-12T04:33:32Z | ~æ•°åƒæ¡ | ç»´åº¦åŒ–è§£è¯»æ•°æ® |

## ğŸ”„ å¯¼å…¥ç­–ç•¥

### 1. æ•°æ®æ˜ å°„ç­–ç•¥
```typescript
// JSON å­—æ®µ â†’ SQLite å­—æ®µæ˜ å°„
interface CardMapping {
  // cards.json
  name: string;           // â†’ cards.name
  arcana: string;         // â†’ cards.arcana  
  suit: string | null;    // â†’ cards.suit
  number: number;         // â†’ cards.number
  image_url: string;      // â†’ cards.image_url
  style_name: string;     // â†’ å…³è”åˆ° card_styles.name è·å– style_id
  deck: string;           // â†’ cards.deck
}
```

### 2. å…³è”å…³ç³»å¤„ç†
- **Card â†’ CardStyle**: é€šè¿‡ `style_name` å­—æ®µå…³è”
- **CardInterpretation â†’ Card**: é€šè¿‡ `card_name` å­—æ®µå…³è”
- **CardInterpretationDimension â†’ Dimension**: é€šè¿‡ `dimension_name` å­—æ®µå…³è”

### 3. æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
- [ ] éªŒè¯æ‰€æœ‰å¤–é”®å¼•ç”¨çš„å®Œæ•´æ€§
- [ ] æ£€æŸ¥æšä¸¾å€¼çš„æœ‰æ•ˆæ€§ (`arcana`, `direction` ç­‰)
- [ ] ç¡®ä¿å¿…å¡«å­—æ®µçš„å®Œæ•´æ€§

## ğŸ› ï¸ æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 1. æ•°æ®åº“è¿æ¥
```typescript
// lib/database/connection.ts
import * as SQLite from 'expo-sqlite';

export const database = SQLite.openDatabaseSync('tarot_config.db');
```

### 2. å¯¼å…¥è„šæœ¬ç»“æ„
```typescript
// lib/database/import.ts
interface ImportResult {
  success: boolean;
  tableName: string;
  recordsImported: number;
  errors?: string[];
}

export class DataImporter {
  async importCardStyles(): Promise<ImportResult>;
  async importCards(): Promise<ImportResult>;
  async importDimensions(): Promise<ImportResult>;
  async importSpreads(): Promise<ImportResult>;
  async importCardInterpretations(): Promise<ImportResult>;
  async importCardInterpretationDimensions(): Promise<ImportResult>;
  
  async importAll(): Promise<ImportResult[]>;
}
```

### 3. é”™è¯¯å¤„ç†
- æ•°æ®æ ¼å¼éªŒè¯
- é‡å¤æ•°æ®å¤„ç†
- äº‹åŠ¡å›æ»šæœºåˆ¶
- å¯¼å…¥è¿›åº¦è·Ÿè¸ª

## ğŸ” æ•°æ®è´¨é‡æ£€æŸ¥

### 1. åŸºç¡€éªŒè¯
- [ ] JSON æ ¼å¼æ­£ç¡®æ€§
- [ ] å¿…å¡«å­—æ®µå®Œæ•´æ€§
- [ ] æ•°æ®ç±»å‹åŒ¹é…
- [ ] å­—ç¬¦ç¼–ç æ­£ç¡®æ€§

### 2. ä¸šåŠ¡é€»è¾‘éªŒè¯
- [ ] 78å¼ ç‰Œçš„å®Œæ•´æ€§ï¼ˆ22å¼ å¤§ç‰Œ + 56å¼ å°ç‰Œï¼‰
- [ ] æ­£ä½/é€†ä½è§£è¯»çš„é…å¯¹å®Œæ•´æ€§
- [ ] ç»´åº¦æ•°æ®çš„ä¸‰ç‰Œæ˜ å°„é€»è¾‘æ­£ç¡®æ€§
- [ ] å›¾ç‰‡è·¯å¾„çš„æœ‰æ•ˆæ€§

### 3. å…³è”æ€§éªŒè¯
- [ ] Card â†’ CardStyle å…³è”å®Œæ•´æ€§
- [ ] CardInterpretation â†’ Card å…³è”å®Œæ•´æ€§  
- [ ] CardInterpretationDimension çš„å¤šé‡å…³è”å®Œæ•´æ€§

## ğŸ“Š é¢„æœŸç»“æœ

### æ•°æ®åº“å¤§å°ä¼°ç®—
- **Card**: 78æ¡è®°å½• â‰ˆ 8KB
- **CardStyle**: 1æ¡è®°å½• â‰ˆ 0.1KB
- **Dimension**: ~200æ¡è®°å½• â‰ˆ 20KB
- **Spread**: 1æ¡è®°å½• â‰ˆ 0.5KB
- **CardInterpretation**: 156æ¡è®°å½• â‰ˆ 50KB
- **CardInterpretationDimension**: ~3000æ¡è®°å½• â‰ˆ 500KB

**æ€»è®¡é¢„ä¼°**: ~580KB (ä¸å«ç´¢å¼•)

### æ€§èƒ½æŒ‡æ ‡
- å¯¼å…¥æ—¶é—´ï¼š< 5ç§’
- æŸ¥è¯¢å“åº”ï¼š< 100ms
- å¯åŠ¨æ—¶é—´ï¼š< 2ç§’

## ğŸš€ æ‰§è¡Œè®¡åˆ’

### ç¬¬1å¤©ï¼šæ¶æ„è®¾è®¡
1. æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡
2. TypeScript ç±»å‹å®šä¹‰
3. å¯¼å…¥è„šæœ¬æ¡†æ¶æ­å»º

### ç¬¬2å¤©ï¼šæ ¸å¿ƒæ•°æ®å¯¼å…¥
1. CardStyle + Card è¡¨å¯¼å…¥
2. Dimension + Spread è¡¨å¯¼å…¥
3. åŸºç¡€åŠŸèƒ½æµ‹è¯•

### ç¬¬3å¤©ï¼šè§£è¯»æ•°æ®å¯¼å…¥
1. CardInterpretation è¡¨å¯¼å…¥
2. CardInterpretationDimension è¡¨å¯¼å…¥
3. æ•°æ®å®Œæ•´æ€§éªŒè¯

### ç¬¬4å¤©ï¼šä¼˜åŒ–ä¸æµ‹è¯•
1. æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
2. é”™è¯¯å¤„ç†å®Œå–„
3. é›†æˆæµ‹è¯•

---

*æ­¤å¯¼å…¥è®¡åˆ’åŸºäºå½“å‰ JSON æ•°æ®æ–‡ä»¶çš„ç»“æ„å’Œå†…å®¹åˆ¶å®šï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚*

## ğŸ“š ç°æœ‰æŠ€æœ¯æ¶æ„å‚è€ƒ

è¯¥ç›®å½•åŒ…å«å¡”ç½—ç‰Œåº”ç”¨çš„æ•°æ®å¯¼å…¥ç³»ç»Ÿï¼Œè´Ÿè´£ä»JSONæ–‡ä»¶åŠ è½½é™æ€æ•°æ®å¹¶å¯¼å…¥åˆ°SQLiteæ•°æ®åº“ä¸­ã€‚ç³»ç»Ÿé‡‡ç”¨å•ä¾‹æ¨¡å¼è®¾è®¡ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œæ€§èƒ½ã€‚

## æ¶æ„è®¾è®¡


### æ ¸å¿ƒç»„ä»¶

**types.ts** - ç±»å‹å®šä¹‰æ–‡ä»¶ï¼Œå®šä¹‰æ‰€æœ‰æ•°æ®ç»“æ„å’Œæ¥å£

## JSONæ•°æ®ç»“æ„å®šä¹‰

### 1. é€šç”¨JSONæ–‡ä»¶ç»“æ„

æ‰€æœ‰JSONæ•°æ®æ–‡ä»¶éƒ½éµå¾ªç»Ÿä¸€çš„æ ¼å¼è§„èŒƒï¼š

```typescript
interface JsonDataFile<T> {
  version: string;        // æ•°æ®ç‰ˆæœ¬å·ï¼Œç”¨äºåŒæ­¥æ§åˆ¶
  updated_at: string;     // æœ€åæ›´æ–°æ—¶é—´æˆ³
  description: string;    // æ•°æ®æè¿°ä¿¡æ¯
  data: T[];             // å®é™…æ•°æ®æ•°ç»„
}
```

### 2. å¡ç‰Œé£æ ¼ (card_styles.json)

å­˜å‚¨ä¸åŒå¡”ç½—ç‰Œé£æ ¼çš„åŸºæœ¬ä¿¡æ¯ï¼š

```json
{
  "version": "1.0.0",
  "updated_at": "2024-01-15T10:00:00Z",
  "description": "å¡”ç½—ç‰Œé£æ ¼å®šä¹‰æ•°æ®",
  "data": [
    {
      "name": "Rider-Waite",
      "image_base_url": "https://example.com/images/rider-waite/"
    },
    {
      "name": "Thoth",
      "image_base_url": "https://example.com/images/thoth/"
    }
  ]
}
```

**å­—æ®µè¯´æ˜ï¼š**
- `name`: é£æ ¼åç§°ï¼Œç”¨äºæ ‡è¯†ä¸åŒçš„ç‰Œé¢é£æ ¼
- `image_base_url`: è¯¥é£æ ¼ä¸‹å›¾ç‰‡çš„åŸºç¡€URLè·¯å¾„

### 3. å¡ç‰Œæ•°æ® (cards.json)

åŒ…å«å®Œæ•´çš„78å¼ å¡”ç½—ç‰Œä¿¡æ¯ï¼š

```json
{
  "version": "1.0.0",
  "updated_at": "2024-01-15T10:00:00Z",
  "description": "å¡”ç½—ç‰Œå¡ç‰Œæ•°æ®ï¼ŒåŒ…å«78å¼ å®Œæ•´å¡ç‰Œ",
  "data": [
    {
      "name": "æ„šè€…",
      "arcana": "Major",
      "suit": null,
      "number": 0,
      "image_url": "fool.jpg",
      "style_name": "Rider-Waite",
      "deck": "æ ‡å‡†å¡”ç½—ç‰Œ"
    },
    {
      "name": "æƒæ–ä¸€",
      "arcana": "Minor",
      "suit": "æƒæ–",
      "number": 1,
      "image_url": "wands_01.jpg",
      "style_name": "Rider-Waite",
      "deck": "æ ‡å‡†å¡”ç½—ç‰Œ"
    }
  ]
}
```

**å­—æ®µè¯´æ˜ï¼š**
- `name`: å¡ç‰Œåç§°ï¼ˆä¸­æ–‡ï¼‰
- `arcana`: å¤§ç‰Œ ("Major") æˆ–å°ç‰Œ ("Minor")
- `suit`: èŠ±è‰²ï¼ˆå°ç‰Œé€‚ç”¨ï¼šæƒæ–ã€åœ£æ¯ã€å®å‰‘ã€é’±å¸ï¼‰
- `number`: å¡ç‰Œåºå·
- `image_url`: å›¾ç‰‡æ–‡ä»¶åï¼ˆç›¸å¯¹äºstyleçš„base_urlï¼‰
- `style_name`: å…³è”çš„é£æ ¼åç§°ï¼ˆæ³¨æ„ï¼šJSONä¸­ä½¿ç”¨nameï¼Œæ•°æ®åº“ä¸­è½¬æ¢ä¸ºIDï¼‰
- `deck`: æ‰€å±ç‰Œç»„åç§°

**æ•°æ®éªŒè¯è§„åˆ™ï¼š**
- æ€»è®¡78å¼ ç‰Œï¼ˆ22å¼ å¤§ç‰Œ + 56å¼ å°ç‰Œï¼‰
- æ¯ä¸ªèŠ±è‰²14å¼ ç‰Œï¼ˆA-10 + 4å¼ å®«å»·ç‰Œï¼‰
- æ‰€æœ‰å¿…è¦å­—æ®µä¸èƒ½ä¸ºç©º

### 4. ç‰Œé˜µæ•°æ® (spreads.json)

å®šä¹‰ä¸åŒçš„å¡”ç½—ç‰Œé˜µå¸ƒå±€ï¼š

```json
{
  "version": "1.0.0",
  "updated_at": "2024-01-15T10:00:00Z",
  "description": "å¡”ç½—ç‰Œé˜µå®šä¹‰æ•°æ®",
  "data": [
    {
      "name": "å•å¼ ç‰Œé˜µ",
      "description": "æŠ½å–ä¸€å¼ ç‰Œè¿›è¡Œç®€å•è§£è¯»",
      "card_count": 1
    },
    {
      "name": "ä¸‰å¼ ç‰Œé˜µ",
      "description": "è¿‡å»-ç°åœ¨-æœªæ¥ä¸‰å¼ ç‰Œè§£è¯»",
      "card_count": 3
    },
    {
      "name": "å‡¯å°”ç‰¹åå­—",
      "description": "ç»å…¸çš„åå¼ ç‰Œå¤æ‚ç‰Œé˜µ",
      "card_count": 10
    }
  ]
}
```

**å­—æ®µè¯´æ˜ï¼š**
- `name`: ç‰Œé˜µåç§°
- `description`: ç‰Œé˜µæè¿°å’Œç”¨é€”
- `card_count`: è¯¥ç‰Œé˜µéœ€è¦çš„å¡ç‰Œæ•°é‡

### 5. è§£è¯»ç»´åº¦æ•°æ® (dimensions.json)

å®šä¹‰å¡”ç½—ç‰Œè§£è¯»çš„ä¸åŒç»´åº¦å’Œç±»åˆ«ã€‚æ­¤å¤„å¼•å…¥ä¸¥æ ¼è§„åˆ™ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼ˆå°¤å…¶é’ˆå¯¹ä¸‰å¼ ç‰Œé˜µçš„æ˜ å°„ï¼‰ã€‚

è§„åˆ™ï¼ˆå¿…é¡»éµå®ˆï¼‰ï¼š
- name: ç»´åº¦å”¯ä¸€æ ‡è¯†ï¼Œå­—ç¬¦ä¸²ï¼Œä¸å¯é‡å¤ã€‚
- category: è¯¥ç»´åº¦æ‰€å±çš„å¤§ç±»ï¼ˆä¾‹å¦‚ æƒ…æ„Ÿã€äº‹ä¸šã€å¥åº·ã€äººé™…ã€å­¦ä¸šã€å†³ç­– ç­‰ï¼‰ã€‚
- description: å¯¹è¯¥ç»´åº¦çš„æ–‡å­—æè¿°ï¼Œç”¨1ã€2å¥è¯æ¥æè¿°ï¼Œè§£è¯»çš„å…³é”®ä¿¡æ¯ã€‚ï¼ˆä¸­æ–‡æˆ–å¤šè¯­è¨€æ–‡æœ¬ï¼‰ã€‚
- aspect: ä¸ä¸‰ç‰Œé˜µï¼ˆè¿‡å»/ç°åœ¨/å°†æ¥ï¼‰ç›´æ¥å…³è”æ—¶ï¼Œå–å›ºå®šå€¼ä¹‹ä¸€ï¼š"è¿‡å»"ã€"ç°åœ¨"ã€"å°†æ¥"ã€‚å¯¹äºéä¸‰ç‰Œé˜µçš„å­ç»´åº¦ï¼ˆä¾‹å¦‚äº’åŠ¨ã€è§’è‰²ã€çŠ¶æ€ç­‰ï¼‰ï¼Œaspect å¯ä¸ºæè¿°æ€§æ–‡æœ¬ï¼Œè§£è¯»çš„å…³é”®ä¿¡æ¯ã€‚
- aspect_type: å­—æ®µï¼›ç”¨äºè¡¨ç¤ºç‰Œåœ¨ç‰Œé˜µä¸­çš„â€œä½æ¬¡â€ã€‚è§„åˆ™å¦‚ä¸‹ï¼š
  - ä¸‰ç‰Œé˜µï¼ˆ3å¼ ï¼‰ï¼šä½¿ç”¨æ•°å­— 1|2|3 åˆ†åˆ«è¡¨ç¤ºç‰Œåœ¨ä¸‰ç‰Œé˜µä¸­çš„ä½ç½®ï¼ˆ1=è¿‡å»ï¼Œ2=ç°åœ¨ï¼Œ3=å°†æ¥ï¼‰ã€‚ä¸‰ç‰Œé˜µçš„ aspect_type åªèƒ½ä¸º 1ã€2ã€3ã€‚
  - å‡¯å°”ç‰¹åå­—ï¼ˆ10å¼ ï¼‰ï¼šä½¿ç”¨æ•´æ•° 1..10 è¡¨ç¤ºç‰Œä½ï¼ˆ1=ç¬¬1ä½ ... 10=ç¬¬10ä½ï¼‰ã€‚å‡¯å°”ç‰¹åå­—çš„ aspect_type åªèƒ½ä¸º 1..10ã€‚
  - éç‰Œä½å…³è”çš„ç»´åº¦æ¡ç›®å¯çœç•¥è¯¥å­—æ®µæˆ–è®¾ä¸º nullã€‚
è¯´æ˜ï¼šå½“å‰ç³»ç»Ÿä»…æ”¯æŒä¸‰ç‰Œé˜µï¼ˆ3å¼ ï¼‰å’Œå‡¯å°”ç‰¹åå­—é˜µï¼ˆ10å¼ ï¼‰ã€‚ä¸è€ƒè™‘å…¶ä»–è‡ªå®šä¹‰ç‰Œé˜µï¼›è‹¥å°†æ¥éœ€è¦æ–°å¢ç‰Œé˜µï¼Œéœ€åœ¨ `spreads.json` ä¸­ç™»è®°å¹¶æ›´æ–°å¯¼å…¥/æ˜ å°„é€»è¾‘ä¸æ ¡éªŒè§„åˆ™ã€‚

ç¤ºä¾‹ï¼ˆåŒ…å«ä¸‰ç‰Œé˜µ & å‡¯å°”ç‰¹åå­—æ˜ å°„çš„è§„èŒƒç¤ºä¾‹ï¼‰ï¼š
```json
{
  "version": "1.0.0",
  "updated_at": "2025-09-12T00:00:00Z",
  "description": "å¡”ç½—ç‰Œè§£è¯»ç»´åº¦å®šä¹‰æ•°æ®ï¼ˆå«ä¸‰ç‰Œé˜µä¸å‡¯å°”ç‰¹åå­—ä½ç½®è§„åˆ™ï¼‰",
  "data": [
    {
      "name": "æƒ…æ„Ÿ-æ—¶é—´çº¿-è¿‡å»",
      "category": "æƒ…æ„Ÿ",
      "description": "æƒ…æ„Ÿå‘å±•çš„è¿‡å»æ–¹å‘",
      "aspect": "è¿‡å»",
      "aspect_type": 1
    },
    {
      "name": "æƒ…æ„Ÿ-æ—¶é—´çº¿-ç°åœ¨",
      "category": "æƒ…æ„Ÿ",
      "description": "æƒ…æ„Ÿå‘å±•çš„å½“å‰çŠ¶æ€",
      "aspect": "ç°åœ¨",
      "aspect_type": 2
    },
    {
      "name": "æƒ…æ„Ÿ-æ—¶é—´çº¿-å°†æ¥",
      "category": "æƒ…æ„Ÿ",
      "description": "æƒ…æ„Ÿå‘å±•çš„æœªæ¥å±•æœ›",
      "aspect": "å°†æ¥",
      "aspect_type": 3
    },
    {
      "name": "å‡¯å°”ç‰¹åå­—-ä½ç½®1",
      "category": "æƒ…æ„Ÿ",
      "description": "å‡¯å°”ç‰¹åå­— ç¬¬1ä½ï¼ˆè¯»è€…/çŠ¶å†µï¼‰",
      "aspect": "ä½ç½®1",
      "aspect_type": 1
    },
    {
      "name": "å‡¯å°”ç‰¹åå­—-ä½ç½®10",
      "category": "æƒ…æ„Ÿ",
      "description": "å‡¯å°”ç‰¹åå­— ç¬¬10ä½ï¼ˆæœ€ç»ˆç»“æœï¼‰",
      "aspect": "ä½ç½®10",
      "aspect_type": 10
    }
  ]
}
```

è¯´æ˜ï¼š
- å¯¹äºâ€œä¸‰ç‰Œé˜µâ€ï¼Œaspect å¿…é¡»å– "è¿‡å»" / "ç°åœ¨" / "å°†æ¥"ï¼Œå¹¶ä¸” aspect_type å¿…é¡»ä½¿ç”¨æ•°å­— 1|2|3 å¯¹åº”ä½ç½®ã€‚
- å¯¹äºâ€œå‡¯å°”ç‰¹åå­—â€ï¼Œaspect_type å¿…é¡»ä½¿ç”¨ 1 åˆ° 10 çš„æ•´æ•°æ¥è¡¨ç¤ºç‰Œä½ï¼ˆ1..10ï¼‰ã€‚ç¤ºä¾‹ä¸­å±•ç¤ºäº†ç¬¬1ä½å’Œç¬¬10ä½çš„å†™æ³•ï¼›å…¶ä½™ 2..9 åŒç†ã€‚
- å½“å‰ç³»ç»Ÿä»…æ”¯æŒä¸‰ç‰Œé˜µï¼ˆ3å¼ ï¼‰å’Œå‡¯å°”ç‰¹åå­—ï¼ˆ10å¼ ï¼‰ã€‚å…¶ä»–è‡ªå®šä¹‰ç‰Œé˜µæš‚ä¸è€ƒè™‘ï¼›è‹¥å°†æ¥æ·»åŠ æ–°é˜µï¼Œéœ€è¦åœ¨ `spreads.json` ä¸­ç™»è®°å¹¶æ‰©å±•å¯¼å…¥/æ˜ å°„é€»è¾‘ã€‚

**å­—æ®µè¯´æ˜ï¼š**
- `name`: ç»´åº¦åç§°ï¼ˆå¦‚ï¼šæƒ…æ„Ÿ-æ—¶é—´çº¿ï¼‰
- `category`: ç±»åˆ«ï¼ˆå¦‚ï¼šæƒ…æ„Ÿã€äº‹ä¸šã€å¥åº·ï¼‰
- `description`: ç»´åº¦è¯¦ç»†æè¿°
- `aspect`: ç»´åº¦çš„å…·ä½“å­é¡¹ï¼ˆå¯é€‰ï¼‰
- `aspect_type`: å­é¡¹çš„ç±»å‹æˆ–åˆ†ç±»ï¼ˆå¯é€‰ï¼‰

### 6. å¡ç‰Œè§£è¯»æ•°æ® (card_interpretations.json)

å­˜å‚¨æ¯å¼ å¡ç‰Œæ­£ä½å’Œé€†ä½çš„åŸºç¡€è§£è¯»ï¼š

```json
{
  "version": "1.0.0",
  "updated_at": "2024-01-15T10:00:00Z",
  "description": "å¡”ç½—ç‰ŒåŸºç¡€è§£è¯»æ•°æ®",
  "data": [
    {
      "card_name": "æ„šè€…",
      "direction": "æ­£ä½",
      "summary": "æ–°çš„å¼€å§‹ï¼Œå¤©çœŸï¼Œè‡ªå‘æ€§",
      "detail": "æ„šè€…ä»£è¡¨æ–°çš„æ—…ç¨‹å’Œæ— é™å¯èƒ½ã€‚æ­£ä½æ—¶è¡¨ç¤ºå‹‡äºå†’é™©ï¼Œä¿æŒå¼€æ”¾å¿ƒæ€è¿æ¥æ–°æœºä¼šã€‚"
    },
    {
      "card_name": "æ„šè€…",
      "direction": "é€†ä½",
      "summary": "é²è½ï¼Œç¼ºä¹è®¡åˆ’ï¼Œå¹¼ç¨š",
      "detail": "é€†ä½çš„æ„šè€…æé†’ä½ è¦æ›´åŠ è°¨æ…ï¼Œé¿å…å†²åŠ¨è¡Œäº‹ï¼Œéœ€è¦æ›´å¥½çš„è§„åˆ’å’Œå‡†å¤‡ã€‚"
    },
    {
      "card_name": "é­”æœ¯å¸ˆ",
      "direction": "æ­£ä½",
      "summary": "æ„å¿—åŠ›ï¼Œåˆ›é€ åŠ›ï¼Œè¡ŒåŠ¨åŠ›",
      "detail": "é­”æœ¯å¸ˆæ‹¥æœ‰å®ç°ç›®æ ‡çš„æ‰€æœ‰å·¥å…·å’Œèƒ½åŠ›ã€‚æ­£ä½è¡¨ç¤ºæœ‰èƒ½åŠ›å°†æƒ³æ³•è½¬åŒ–ä¸ºç°å®ã€‚"
    }
  ]
}
```

**å­—æ®µè¯´æ˜ï¼š**
- `card_name`: å¡ç‰Œåç§°ï¼ˆæ³¨æ„ï¼šJSONä¸­ä½¿ç”¨åç§°ï¼Œæ•°æ®åº“ä¸­è½¬æ¢ä¸ºIDï¼‰
- `direction`: æ­£ä½æˆ–é€†ä½
- `summary`: ç®€è¦ç‰Œæ„
- `detail`: è¯¦ç»†è¯´æ˜ï¼ˆå¯é€‰ï¼‰

### 7. å¡ç‰Œè§£è¯»ç»´åº¦å…³è”æ•°æ® (card_interpretation_dimensions.json)

å°†å¡ç‰Œè§£è¯»ä¸å…·ä½“ç»´åº¦å…³è”ï¼Œæä¾›ç»†ç²’åº¦çš„è§£è¯»å†…å®¹ã€‚éµå¾ªä¸Šæ–‡ç»´åº¦è§„åˆ™æ—¶ï¼Œè¯·æ³¨æ„ä¸‰ç‰Œé˜µæ˜ å°„çš„ä¸€è‡´æ€§ï¼ˆaspect ä¸ aspect_type å¿…é¡»åŒ¹é…ï¼‰ã€‚

ç¤ºä¾‹ï¼ˆä½¿ç”¨ä¸‰ç‰Œé˜µä½ç½®æ•°å­—åŒ–çš„è§„èŒƒç¤ºä¾‹ï¼‰ï¼š
```json
{
  "version": "1.0.0",
  "updated_at": "2025-09-12T00:00:00Z",
  "description": "å¡”ç½—ç‰Œè§£è¯»ç»´åº¦å…³è”æ•°æ®ï¼ˆä¸ dimensions.json ä¸€è‡´ï¼‰",
  "data": [
    {
      "card_name": "æ„šè€…",
      "direction": "æ­£ä½",
      "dimension_name": "æƒ…æ„Ÿ-æ—¶é—´çº¿-è¿‡å»",
      "aspect": "è¿‡å»",
      "aspect_type": 1,
      "content": "åœ¨æƒ…æ„Ÿè¿‡å»ä¸­ï¼Œä½ æ›¾ç»å¾ˆå¤©çœŸçº¯æ´ï¼Œå¯¹çˆ±æƒ…å……æ»¡ç¾å¥½æœŸå¾…ã€‚"
    },
    {
      "card_name": "æ„šè€…",
      "direction": "æ­£ä½",
      "dimension_name": "æƒ…æ„Ÿ-æ—¶é—´çº¿-ç°åœ¨",
      "aspect": "ç°åœ¨",
      "aspect_type": 2,
      "content": "ç›®å‰çš„æƒ…æ„ŸçŠ¶æ€å……æ»¡æ–°é²œæ„Ÿï¼Œå‡†å¤‡å¼€å§‹ä¸€æ®µæ–°çš„æ„Ÿæƒ…å†ç¨‹ã€‚"
    },
    {
      "card_name": "æ„šè€…",
      "direction": "é€†ä½",
      "dimension_name": "äº‹ä¸š-å‘å±•è¶‹åŠ¿",
      "aspect": "å‘å±•",
      "content": "åœ¨äº‹ä¸šå‘å±•ä¸Šéœ€è¦æ›´åŠ è°¨æ…ï¼Œé¿å…ç›²ç›®æŠ•èµ„æˆ–å†²åŠ¨å†³ç­–ã€‚"
    },
    {
      "card_name": "é­”æœ¯å¸ˆ",
      "direction": "æ­£ä½",
      "dimension_name": "å¥åº·-èº«ä½“çŠ¶å†µ",
      "content": "èº«ä½“çŠ¶å†µè‰¯å¥½ï¼Œæœ‰è¶³å¤Ÿçš„æ´»åŠ›å’Œèƒ½é‡æ¥åº”å¯¹ç”Ÿæ´»æŒ‘æˆ˜ã€‚"
    }
  ]
}
```

å­—æ®µè¯´æ˜ï¼ˆæ›´æ–°ï¼‰ï¼š
- `card_name`: å…³è”çš„å¡ç‰Œåç§°ï¼ˆJSON ä½¿ç”¨åç§°ï¼›å¯¼å…¥æ—¶è½¬æ¢ä¸º card.idï¼‰ã€‚
- `direction`: æ­£ä½æˆ–é€†ä½ã€‚
- `dimension_name`: å…³è”çš„ç»´åº¦åç§°ï¼ˆå¿…é¡»ä¸ dimensions.json ä¸­çš„ name ä¸€è‡´ï¼›ä¸‰ç‰Œé˜µå»ºè®®ä½¿ç”¨å¸¦åç¼€çš„ç»†åŒ–åç§°ï¼Œå¦‚ "æƒ…æ„Ÿ-æ—¶é—´çº¿-è¿‡å»"ï¼‰ã€‚
- `aspect`: å…·ä½“ç»´åº¦å­é¡¹ï¼›å¯¹äºä¸‰ç‰Œé˜µå¿…é¡»æ˜¯ "è¿‡å»"/"ç°åœ¨"/"å°†æ¥" ä¹‹ä¸€ï¼ˆä» dimension å¤åˆ¶ï¼Œå¯é€‰ä½†å»ºè®®ä¿æŒä¸€è‡´ï¼‰ã€‚å¯¹äºå‡¯å°”ç‰¹åå­—ï¼Œaspect å¯å†™ä¸ºæè¿°æ€§çš„ "ä½ç½®X"ï¼ˆä¾‹å¦‚ "ä½ç½®1"ã€"ä½ç½®10"ï¼‰ä»¥ä¾¿å¯è¯»æ€§ï¼Œä½†å¿…é¡»ä¸ `aspect_type` ä¿æŒä¸€è‡´ã€‚
- `aspect_type`: å­—æ®µï¼›è¡¨ç¤ºç‰Œåœ¨ç‰Œé˜µä¸­çš„ä½æ¬¡ï¼š
  - ä¸‰ç‰Œé˜µï¼š1|2|3ï¼ˆ1=è¿‡å»,2=ç°åœ¨,3=å°†æ¥ï¼‰
  - å‡¯å°”ç‰¹åå­—ï¼š1..10ï¼ˆ1=ç¬¬1ä½ ... 10=ç¬¬10ä½ï¼‰
  å½“å‰ç³»ç»Ÿä»…æ”¯æŒä¸‰ç‰Œé˜µå’Œå‡¯å°”ç‰¹åå­—é˜µï¼›è¯·å‹¿ä½¿ç”¨è¶…å‡ºä¸Šè¿°èŒƒå›´çš„æ•°å­—ã€‚éç‰Œä½å…³è”çš„ç»´åº¦æ¡ç›®å¯çœç•¥æˆ–å°†è¯¥å­—æ®µè®¾ä¸º nullã€‚
- `content`: è¯¥ç»´åº¦ä¸‹çš„å…·ä½“è§£è¯»æ–‡å­—ã€‚

**å­—æ®µè¯´æ˜ï¼š**
- `card_name`: å…³è”çš„å¡ç‰Œåç§°
- `direction`: æ­£ä½æˆ–é€†ä½
- `dimension_name`: å…³è”çš„ç»´åº¦åç§°
- `aspect`: å…·ä½“ç»´åº¦å­é¡¹ï¼ˆä»dimensionå¤åˆ¶ï¼Œå¯é€‰ï¼‰
- `aspect_type`: å­é¡¹çš„ç±»å‹æˆ–åˆ†ç±»ï¼ˆä»dimensionå¤åˆ¶ï¼Œå¯é€‰ï¼‰
- `content`: è¯¥ç»´åº¦ä¸‹çš„å…·ä½“è§£è¯»æ–‡å­—

## æ•°æ®å¯¼å…¥æµç¨‹

### å¯¼å…¥é¡ºåº

æ•°æ®å¯¼å…¥ä¸¥æ ¼æŒ‰ç…§ä¾èµ–å…³ç³»é¡ºåºæ‰§è¡Œï¼š

1. **card_style** - å¡ç‰Œé£æ ¼ï¼ˆæ— ä¾èµ–ï¼‰
2. **dimension** - è§£è¯»ç»´åº¦ï¼ˆæ— ä¾èµ–ï¼‰
3. **card** - å¡ç‰Œæ•°æ®ï¼ˆä¾èµ– card_styleï¼‰
4. **spread** - ç‰Œé˜µæ•°æ®ï¼ˆæ— ä¾èµ–ï¼‰
5. **card_interpretation** - å¡ç‰Œè§£è¯»ï¼ˆä¾èµ– cardï¼‰
6. **card_interpretation_dimension** - è§£è¯»ç»´åº¦å…³è”ï¼ˆä¾èµ– card_interpretation å’Œ dimensionï¼‰

### å¯¼å…¥ç­–ç•¥

```typescript
// å¯¼å…¥ä¼šè¯çŠ¶æ€è·Ÿè¸ª
interface ImportSession {
  sessionId: string;       // å¯¼å…¥ä¼šè¯ID
  startTime: string;       // å¼€å§‹æ—¶é—´
  tables: ImportStatus[];  // å„è¡¨å¯¼å…¥çŠ¶æ€
  totalProgress: number;   // æ€»ä½“è¿›åº¦ç™¾åˆ†æ¯”
  isCompleted: boolean;    // æ˜¯å¦å®Œæˆ
}

// å•è¡¨å¯¼å…¥çŠ¶æ€
interface ImportStatus {
  table: string;           // è¡¨å
  status: 'pending' | 'importing' | 'completed' | 'error';
  result?: ImportResult;   // å¯¼å…¥ç»“æœè¯¦æƒ…
  error?: string;         // é”™è¯¯ä¿¡æ¯
}

// å¯¼å…¥ç»“æœç»Ÿè®¡
interface ImportResult {
  success: boolean;        // æ˜¯å¦æˆåŠŸ
  imported: number;        // å¯¼å…¥è®°å½•æ•°
  skipped: number;         // è·³è¿‡è®°å½•æ•°
  errors: string[];        // é”™è¯¯åˆ—è¡¨
}
```

### é‡å¤å¯¼å…¥å¤„ç†

ç³»ç»Ÿé‡‡ç”¨æ™ºèƒ½é‡å¤æ£€æµ‹ï¼š

1. **å­˜åœ¨æ€§æ£€æŸ¥** - å¯¼å…¥å‰æ£€æŸ¥è¡¨ä¸­æ˜¯å¦å·²æœ‰æ•°æ®
2. **è·³è¿‡ç­–ç•¥** - å¦‚æœæ•°æ®å·²å­˜åœ¨ï¼Œè·³è¿‡å¯¼å…¥å¹¶è®°å½•ä¸º `skipped`
3. **å¼ºåˆ¶é‡å¯¼** - æä¾› `clearAllTables()` æ–¹æ³•æ¸…ç©ºæ•°æ®åé‡æ–°å¯¼å…¥

### å…³è”å…³ç³»å¤„ç†

**cardè¡¨ä¸­çš„style_name â†’ style_idè½¬æ¢ï¼š**

```typescript
// JSONä¸­ä½¿ç”¨é£æ ¼åç§°
{
  "style_name": "Rider-Waite"  // äººç±»å¯è¯»çš„åç§°
}

// æ•°æ®åº“ä¸­ä½¿ç”¨å¤–é”®ID
{
  "style_id": 1  // å…³è”åˆ° card_style.id
}

// è½¬æ¢è¿‡ç¨‹
const styleNameToIdMap = await this.createStyleNameToIdMap();
const styleId = styleNameToIdMap[card.style_name];
```

**card_interpretationè¡¨ä¸­çš„card_name â†’ card_idè½¬æ¢ï¼š**

```typescript
// JSONä¸­ä½¿ç”¨å¡ç‰Œåç§°
{
  "card_name": "æ„šè€…"  // äººç±»å¯è¯»çš„å¡ç‰Œåç§°
}

// æ•°æ®åº“ä¸­ä½¿ç”¨å¤–é”®ID
{
  "card_id": 1  // å…³è”åˆ° card.id
}

// è½¬æ¢è¿‡ç¨‹
const cardNameToIdMap = await this.createCardNameToIdMap();
const cardId = cardNameToIdMap[interpretation.card_name];
```

**card_interpretation_dimensionè¡¨ä¸­çš„å¤šé‡åç§° â†’ IDè½¬æ¢ï¼š**

```typescript
// JSONä¸­ä½¿ç”¨åç§°ç»„åˆ
{
  "card_name": "æ„šè€…",
  "direction": "æ­£ä½",
  "dimension_name": "æƒ…æ„Ÿ-æ—¶é—´çº¿"
}

// æ•°æ®åº“ä¸­ä½¿ç”¨å¤–é”®IDç»„åˆ
{
  "interpretation_id": 1,  // å…³è”åˆ°ç‰¹å®šå¡ç‰Œ+æ–¹å‘çš„è§£è¯»
  "dimension_id": 2        // å…³è”åˆ° dimension.id
}

// è½¬æ¢è¿‡ç¨‹
const interpretationKey = `${item.card_name}-${item.direction}`;
const interpretationId = interpretationMap[interpretationKey];
const dimensionId = dimensionNameToIdMap[item.dimension_name];
```

## é”™è¯¯å¤„ç†

### JSONåŠ è½½é”™è¯¯
- æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ— æ³•è®¿é—®
- JSONæ ¼å¼é”™è¯¯
- æ•°æ®ç»“æ„éªŒè¯å¤±è´¥
- å¿…è¦å­—æ®µç¼ºå¤±

### æ•°æ®å¯¼å…¥é”™è¯¯
- æ•°æ®åº“è¿æ¥å¤±è´¥
- çº¦æŸè¿åï¼ˆå¦‚é‡å¤ä¸»é”®ï¼‰
- å¤–é”®å…³è”é”™è¯¯
- æ‰¹é‡æ“ä½œéƒ¨åˆ†å¤±è´¥

### é”™è¯¯æ¢å¤æœºåˆ¶
```typescript
// å¯¼å…¥å¤±è´¥æ—¶çš„çŠ¶æ€ä¿æŒ
catch (error) {
  status.status = 'error';
  status.error = error.message;
  status.result = {
    success: false,
    imported: 0,
    skipped: 0,
    errors: [error.message]
  };
}
```

## æ€§èƒ½ä¼˜åŒ–

### æ‰¹é‡æ“ä½œ
```typescript
// ä½¿ç”¨æ‰¹é‡æ’å…¥æé«˜æ€§èƒ½
const insertStatements = cards.map(card => ({
  sql: 'INSERT INTO card (...) VALUES (?, ?, ...)',
  params: [card.name, card.arcana, ...]
}));

const result = await this.dbService.executeBatch(insertStatements);
```

### å¹¶è¡ŒåŠ è½½
```typescript
// å¹¶è¡ŒåŠ è½½å¤šä¸ªJSONæ–‡ä»¶
const [cardStyles, cards, spreads] = await Promise.all([
  this.loadCardStyles(),
  this.loadCards(),
  this.loadSpreads()
]);
```

### å†…å­˜ç®¡ç†
- å•ä¾‹æ¨¡å¼é¿å…é‡å¤å®ä¾‹åŒ–
- åŠæ—¶é‡Šæ”¾å¤§å‹JSONæ•°æ®å¯¹è±¡
- æµå¼å¤„ç†å¤§æ–‡ä»¶ï¼ˆæœªæ¥æ‰©å±•ï¼‰

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬å¯¼å…¥æµç¨‹
```typescript
import { DataImporter } from './DataImporter';

// è·å–å¯¼å…¥å™¨å®ä¾‹
const importer = DataImporter.getInstance();

// æ‰§è¡Œå®Œæ•´å¯¼å…¥
const session = await importer.importAll();

// æ£€æŸ¥å¯¼å…¥ç»“æœ
if (session.isCompleted) {
  console.log('å¯¼å…¥å®Œæˆï¼');
  session.tables.forEach(table => {
    if (table.status === 'completed') {
      console.log(`${table.table}: ${table.result?.imported} imported`);
    }
  });
}
```

### å•ç‹¬åŠ è½½JSON
```typescript
import { JsonLoader } from './JsonLoader';

// è·å–åŠ è½½å™¨å®ä¾‹
const loader = JsonLoader.getInstance();

// åŠ è½½ç‰¹å®šæ–‡ä»¶
const cardsData = await loader.loadCards();
console.log(`åŠ è½½äº† ${cardsData.data.length} å¼ å¡ç‰Œ`);

// æ£€æŸ¥æ•°æ®ç‰ˆæœ¬
const versions = await loader.checkDataVersions();
console.log('æ•°æ®ç‰ˆæœ¬ï¼š', versions);
```

### æ¸…ç†å’Œé‡å»º
```typescript
// æ¸…ç©ºæ‰€æœ‰è¡¨
await importer.clearAllTables();

// é‡æ–°å¯¼å…¥
const newSession = await importer.importAll();
```

## æ‰©å±•æ€§è®¾è®¡

### æ–°å¢æ•°æ®è¡¨
1. åœ¨ `types.ts` ä¸­å®šä¹‰JSONæ¥å£
2. åœ¨ `JsonLoader` ä¸­æ·»åŠ åŠ è½½æ–¹æ³•
3. åœ¨ `DataImporter` ä¸­æ·»åŠ å¯¼å…¥æ–¹æ³•
4. æ›´æ–°å¯¼å…¥é¡ºåºï¼ˆè€ƒè™‘ä¾èµ–å…³ç³»ï¼‰

### ç‰ˆæœ¬æ§åˆ¶
- JSONæ–‡ä»¶åŒ…å«versionå­—æ®µç”¨äºç‰ˆæœ¬ç®¡ç†
- æ”¯æŒå¢é‡æ›´æ–°ï¼ˆæœªæ¥æ‰©å±•ï¼‰
- å‘åå…¼å®¹æ€§æ£€æŸ¥

### æ•°æ®åŒæ­¥å‡†å¤‡
è¯¥ç³»ç»Ÿä¸ºæœªæ¥çš„æœåŠ¡ç«¯åŒæ­¥åŠŸèƒ½é¢„ç•™äº†æ‰©å±•æ¥å£ï¼Œæ”¯æŒï¼š
- ç‰ˆæœ¬æ¯”è¾ƒ
- å¢é‡æ›´æ–°æ£€æµ‹
- å†²çªè§£å†³ç­–ç•¥

---

*è¯¥æ–‡æ¡£æè¿°äº†å¡”ç½—ç‰Œåº”ç”¨æ•°æ®å±‚çš„å®Œæ•´è®¾è®¡å’Œå®ç°ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€å®Œæ•´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚*